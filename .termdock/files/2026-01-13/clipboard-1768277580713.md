
  æˆ‘å·²ç¶“æ‰¾å‡ºé€ æˆæŠ–å‹•çš„æ ¹æœ¬åŽŸå› ã€‚ä»¥ä¸‹æ˜¯è©³ç´°åˆ†æžï¼š

  ---
  å•é¡Œ 1: åŒç¾¤çµ„å…§æ‹–åˆ°æœ€å¾Œæ™‚ Ghost ç˜‹ç‹‚æŠ–å‹•

  æ ¹æœ¬åŽŸå› ï¼š

  åœ¨ computeGhostIndex (CardGrid.tsx:103-165) ä¸­ï¼Œç•¶æ‹–æ›³åˆ°æœ€å¾Œä¸€å¼µå¡ç‰‡é™„è¿‘æ™‚ï¼š

  // line 158-162
  if (clientX > centerX) {
    return closestIndex + 1;  // æ’å…¥åˆ°æœ€å¾Œ
  } else {
    return closestIndex;       // æ’å…¥åˆ°å€’æ•¸ç¬¬äºŒå€‹ä½ç½®
  }

  æŠ–å‹•æ©Ÿåˆ¶ï¼š

  1. è‡¨ç•Œé»žå•é¡Œï¼šç•¶æ»‘é¼ åœ¨æœ€å¾Œä¸€å¼µå¡ç‰‡çš„ä¸­å¿ƒç·šï¼ˆcenterXï¼‰é™„è¿‘ç§»å‹•æ™‚ï¼š
    - clientX = centerX + 1px â†’ è¿”å›ž closestIndex + 1ï¼ˆæœ€å¾Œï¼‰
    - clientX = centerX - 1px â†’ è¿”å›ž closestIndexï¼ˆå€’æ•¸ç¬¬äºŒï¼‰
    - å¾®å°çš„æ»‘é¼ æŠ–å‹•å°±æœƒåœ¨å…©å€‹ä½ç½®é–“å¿«é€Ÿåˆ‡æ›
  2. ç¼ºä¹æ»¯å¾Œæ©Ÿåˆ¶ï¼ˆHysteresisï¼‰ï¼šæ²’æœ‰ç·©è¡å€æˆ–é˜²æŠ–å‹•é‚è¼¯ï¼Œæ¯æ¬¡è¨ˆç®—çµæžœæ”¹è®Šéƒ½ç«‹å³æ›´æ–° ghost ä½ç½®
  3. è¦–è¦ºåé¥‹å¾ªç’°ï¼š
  æ»‘é¼ å¾®å‹• â†’ ghost åˆ‡æ›ä½ç½® â†’ ç•«é¢é‡æŽ’ â†’
  å¡ç‰‡ä½ç½®æ”¹è®Š â†’ ä¸‹æ¬¡è¨ˆç®—çµæžœä¸åŒ â†’ ç¹¼çºŒæŠ–å‹•

  ---
  å•é¡Œ 2: F12 é–‹å•Ÿå¾Œï¼ˆä¸€è¡Œä¸‰å€‹ï¼‰ç¾¤çµ„é–“æ‹–ç§»æŠ–å‹•

  æ ¹æœ¬åŽŸå› ï¼š

  1. ç¶²æ ¼ä½ˆå±€æ”¹è®Šå°Žè‡´è·é›¢è¨ˆç®—ä¸ç©©å®šï¼š
    - å¾žä¸€è¡Œ 4 å€‹è®Šæˆä¸€è¡Œ 3 å€‹æ™‚ï¼Œå¡ç‰‡çš„ 2D åº§æ¨™åˆ†ä½ˆæ”¹è®Š
    - æ­å¹¾é‡Œå¾—è·é›¢è¨ˆç®—åœ¨è¡Œå°¾/è¡Œé¦–çš„è½‰æŠ˜é»žç”¢ç”Ÿæ­§ç¾©

  ä¸€è¡Œ 4 å€‹:  [A] [B] [C] [D]
  ä¸€è¡Œ 3 å€‹:  [A] [B] [C]
              [D] ...

  ç•¶æ»‘é¼ åœ¨ C å’Œ D ä¹‹é–“æ™‚ï¼Œå¯èƒ½ï¼š
    - æŸæ™‚åˆ»è·é›¢ C è¼ƒè¿‘ï¼ˆæ’å…¥åˆ° C å¾Œé¢ï¼‰
    - ä¸‹ä¸€æ™‚åˆ»è·é›¢ D è¼ƒè¿‘ï¼ˆæ’å…¥åˆ° D å‰é¢ï¼‰
    - ä½†é€™å…©å€‹ä½ç½®å…¶å¯¦æ˜¯åŒä¸€å€‹é‚è¼¯æ’å…¥é»žï¼
  2. ç¾¤çµ„é–“æ‹–ç§»çš„é¡å¤–è¤‡é›œåº¦ï¼š
    - line 375: items.filter((x) => x.id !== draggingCardId) æœƒå¾žæºç¾¤çµ„ç§»é™¤æ‹–æ›³å¡ç‰‡
    - ç›®æ¨™ç¾¤çµ„çš„å¡ç‰‡æ•¸é‡å’Œä½ˆå±€å¯èƒ½ä¸åŒ
    - å°Žè‡´è·é›¢è¨ˆç®—åƒè€ƒé»žä¸ç©©å®š
  3. Render ä¸­çš„ç„¡æ•ˆè¨ˆç®—ï¼ˆline 380ï¼‰ï¼š
  const calculatedIndex = computeGhostIndex(null as any, null as any, null as any);
  3. é€™è¡Œç¨‹å¼ç¢¼å‚³å…¥ nullï¼Œç¸½æ˜¯è¿”å›ž nullï¼Œæ²’æœ‰å¯¦éš›ä½œç”¨ä½†å¢žåŠ äº†æ··äº‚

  ---
  å•é¡Œ 3: æœªå®šç¾©çš„ prevGiRef (Bug)

  åš´é‡å•é¡Œï¼šç¨‹å¼ç¢¼åœ¨ line 188 å’Œ 222 ä½¿ç”¨äº† prevGiRef.currentï¼Œä½†é€™å€‹ ref å¾žæœªè¢«å®šç¾©ï¼

  // line 188, 222
  if (gi !== prevGiRef.current) { prevGiRef.current = gi; ... }

  é€™æœƒå°Žè‡´ runtime error: Cannot read property 'current' of undefined

  ---
  ðŸ’¡ æŠ–å‹•çš„æŠ€è¡“æˆå› ç¸½çµ
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚      å•é¡Œ      â”‚       è§¸ç™¼æ¢ä»¶        â”‚         æŠ€è¡“åŽŸå›          â”‚       å½±éŸ¿ç¯„åœ       â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ æœ€å¾Œä½ç½®æŠ–å‹•   â”‚ æ‹–åˆ°è¡Œå°¾/ç¾¤çµ„å°¾       â”‚ centerX è‡¨ç•Œé»žç„¡æ»¯å¾Œæ©Ÿåˆ¶ â”‚ åŒç¾¤çµ„å…§             â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ è·¨ç¾¤çµ„æŠ–å‹•     â”‚ ç•«é¢å£“ç¸® + ç¾¤çµ„é–“æ‹–ç§» â”‚ 2D ç¶²æ ¼è½‰æŠ˜é»žè·é›¢æ­§ç¾©    â”‚ ç¾¤çµ„é–“               â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ è¨ˆç®—ä¸ç©©å®š     â”‚ æ‰€æœ‰æ‹–ç§»              â”‚ ç¼ºå°‘é˜²æŠ–å‹•ã€æ–¹å‘æ€§åå¥½   â”‚ å…¨åŸŸ                 â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ Bug: prevGiRef â”‚ æ‰€æœ‰æ‹–ç§»              â”‚ æœªå®šç¾©çš„ ref ä½¿ç”¨        â”‚ å…¨åŸŸ (runtime error) â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  ---
  ðŸŽ¯ å»ºè­°çš„è§£æ±ºæ–¹æ¡ˆ

  1. åŠ å…¥ Hysteresisï¼ˆæ»¯å¾Œï¼‰æ©Ÿåˆ¶

  const HYSTERESIS_THRESHOLD = 0.15; // 15% ç·©è¡å€

  if (clientX > centerX * (1 + HYSTERESIS_THRESHOLD)) {
    return closestIndex + 1;
  } else if (clientX < centerX * (1 - HYSTERESIS_THRESHOLD)) {
    return closestIndex;
  } else {
    // åœ¨ç·©è¡å€å…§ï¼Œä¿æŒä¸Šä¸€æ¬¡çš„æ±ºå®š
    return prevIndex ?? closestIndex;
  }

  2. æ–¹å‘æ€§åå¥½

  è¨˜ä½æ»‘é¼ ç§»å‹•æ–¹å‘ï¼Œåœ¨è·é›¢æŽ¥è¿‘æ™‚å„ªå…ˆé¸æ“‡èˆ‡ç§»å‹•æ–¹å‘ä¸€è‡´çš„ä½ç½®

  3. ä¿®æ­£ prevGiRef æœªå®šç¾©å•é¡Œ

  const prevGiRef = React.useRef<number | null>(null);

  4. ç§»é™¤ render ä¸­çš„ç„¡æ•ˆè¨ˆç®—

  line 380 çš„ computeGhostIndex(null as any, ...) æ‡‰è©²ç§»é™¤