# Capability: Drag and Drop

## Purpose
æä¾›ç›´è¦ºçš„æ‹–æ”¾æ“ä½œä»‹é¢ï¼Œè®“ä½¿ç”¨è€…å¯ä»¥é‡æ–°æ’åˆ—å¡ç‰‡é †åºã€è·¨ç¾¤çµ„ç§»å‹•å¡ç‰‡ï¼Œä¸¦å³æ™‚æŒä¹…åŒ–è®Šæ›´åˆ° IndexedDBã€‚æ‹–æ”¾æ“ä½œæ˜¯ LinkTrove çš„æ ¸å¿ƒ UX åŠŸèƒ½ã€‚
## Requirements
### Requirement: å¡ç‰‡æ‹–æ”¾æ’åº
ç³»çµ±å¿…é ˆï¼ˆSHALLï¼‰æ”¯æ´åœ¨åŒä¸€ç¾¤çµ„å…§æ‹–æ”¾å¡ç‰‡ä»¥èª¿æ•´é¡¯ç¤ºé †åºï¼Œä¸¦å³æ™‚å„²å­˜è®Šæ›´ã€‚

#### Scenario: æ‹–å‹•å¡ç‰‡æ™‚é¡¯ç¤ºè¦–è¦ºåé¥‹
- **WHEN** ä½¿ç”¨è€…é–‹å§‹æ‹–å‹•å¡ç‰‡ A
- **THEN** å¡ç‰‡ A è®Šç‚ºåŠé€æ˜ï¼ˆopacity: 0.5ï¼‰
- **THEN** æ»‘é¼ æ¸¸æ¨™è®Šç‚ºã€ŒæŠ“å–ã€åœ–ç¤º
- **THEN** å…¶ä»–å¡ç‰‡ä¿æŒæ­£å¸¸é¡¯ç¤º

#### Scenario: æ‹–å‹•éç¨‹ä¸­é¡¯ç¤ºæ’å…¥ä½ç½®
- **GIVEN** ä½¿ç”¨è€…æ­£åœ¨æ‹–å‹•å¡ç‰‡ A
- **WHEN** æ»‘é¼ ç§»å‹•åˆ°å¡ç‰‡ B å’Œå¡ç‰‡ C ä¹‹é–“
- **THEN** ç³»çµ±åœ¨ B å’Œ C ä¹‹é–“é¡¯ç¤ºæ’å…¥æŒ‡ç¤ºç·šï¼ˆè—è‰²è™›ç·šï¼‰
- **THEN** å…¶ä»–å¡ç‰‡ä¿æŒåŸä½

#### Scenario: æ”¾ä¸‹å¡ç‰‡æ™‚æ›´æ–°é †åº
- **GIVEN** ç¾¤çµ„ G çš„åŸå§‹é †åºç‚º [card1, card2, card3, card4]
- **WHEN** ä½¿ç”¨è€…å°‡ card4 æ‹–æ”¾åˆ° card1 å’Œ card2 ä¹‹é–“
- **THEN** å¡ç‰‡ç«‹å³é‡æ–°æ’åˆ—ç‚º [card1, card4, card2, card3]
- **THEN** ç³»çµ±æ›´æ–° IndexedDB çš„ `orders.subcategories[G]` ç‚º `["card1", "card4", "card2", "card3"]`
- **THEN** è¦–è¦ºåé¥‹æ¶ˆå¤±ï¼ˆåŠé€æ˜å’Œæ’å…¥ç·šç§»é™¤ï¼‰

#### Scenario: å–æ¶ˆæ‹–å‹•æ“ä½œ
- **GIVEN** ä½¿ç”¨è€…æ­£åœ¨æ‹–å‹•å¡ç‰‡ A
- **WHEN** ä½¿ç”¨è€…æŒ‰ä¸‹ ESC éµæˆ–å°‡å¡ç‰‡æ‹–åˆ°ç„¡æ•ˆå€åŸŸ
- **THEN** å¡ç‰‡ A è¿”å›åŸå§‹ä½ç½®
- **THEN** é †åºä¿æŒä¸è®Š
- **THEN** è¦–è¦ºåé¥‹æ¶ˆå¤±

#### Scenario: æ‹–æ”¾å¾Œé‡æ–°è¼‰å…¥ä¿æŒé †åº
- **GIVEN** ä½¿ç”¨è€…å°‡ç¾¤çµ„ G çš„å¡ç‰‡é †åºèª¿æ•´ç‚º [card3, card1, card2]
- **WHEN** ä½¿ç”¨è€…é—œé–‰ä¸¦é‡æ–°é–‹å•Ÿæ–°åˆ†é 
- **THEN** ç³»çµ±å¾ IndexedDB è®€å– `orders.subcategories[G]`
- **THEN** ç¾¤çµ„ G çš„å¡ç‰‡ä»¥ [card3, card1, card2] é †åºé¡¯ç¤º

### Requirement: è·¨ç¾¤çµ„æ‹–æ”¾ç§»å‹•
ç³»çµ±å¿…é ˆï¼ˆSHALLï¼‰æ”¯æ´å°‡å¡ç‰‡å¾ä¸€å€‹ç¾¤çµ„æ‹–æ”¾åˆ°å¦ä¸€å€‹ç¾¤çµ„ï¼Œä¸¦æ­£ç¢ºæ›´æ–°å¡ç‰‡çš„æ­¸å±¬å’Œé †åºè³‡è¨Šã€‚

#### Scenario: å°‡å¡ç‰‡æ‹–æ”¾åˆ°å¦ä¸€å€‹ç¾¤çµ„
- **GIVEN** å¡ç‰‡ X å±¬æ–¼ç¾¤çµ„ A
- **GIVEN** ç¾¤çµ„ A çš„é †åºç‚º [cardX, cardY]
- **GIVEN** ç¾¤çµ„ B çš„é †åºç‚º [card1, card2]
- **WHEN** ä½¿ç”¨è€…å°‡å¡ç‰‡ X æ‹–æ”¾åˆ°ç¾¤çµ„ Bï¼ˆåœ¨ card1 å’Œ card2 ä¹‹é–“ï¼‰
- **THEN** å¡ç‰‡ X çš„ `subcategoryId` æ›´æ–°ç‚ºç¾¤çµ„ B çš„ ID
- **THEN** å¡ç‰‡ X çš„ `category` æ›´æ–°ç‚ºç¾¤çµ„ B æ‰€å±¬çš„é¡åˆ¥ ID
- **THEN** ç¾¤çµ„ A çš„é †åºæ›´æ–°ç‚º `["cardY"]`ï¼ˆç§»é™¤ cardXï¼‰
- **THEN** ç¾¤çµ„ B çš„é †åºæ›´æ–°ç‚º `["card1", "cardX", "card2"]`ï¼ˆæ’å…¥ cardXï¼‰
- **THEN** å…©å€‹ç¾¤çµ„çš„ IndexedDB è³‡æ–™éƒ½æ›´æ–°

#### Scenario: æ‹–æ”¾åˆ°ç©ºç¾¤çµ„
- **GIVEN** ç¾¤çµ„ C ç›®å‰æ²’æœ‰ä»»ä½•å¡ç‰‡
- **WHEN** ä½¿ç”¨è€…å°‡å¡ç‰‡ Z æ‹–æ”¾åˆ°ç¾¤çµ„ C
- **THEN** å¡ç‰‡ Z çš„ `subcategoryId` æ›´æ–°ç‚ºç¾¤çµ„ C çš„ ID
- **THEN** ç¾¤çµ„ C çš„é †åºå»ºç«‹ç‚º `["cardZ"]`
- **THEN** ç¾¤çµ„ C é¡¯ç¤ºè©²å¡ç‰‡

#### Scenario: è·¨ç¾¤çµ„æ‹–æ”¾æ™‚æ›´æ–°å¡ç‰‡è¨ˆæ•¸
- **GIVEN** ç¾¤çµ„ A æœ‰ 5 å¼µå¡ç‰‡ï¼Œç¾¤çµ„ B æœ‰ 3 å¼µå¡ç‰‡
- **WHEN** ä½¿ç”¨è€…å°‡å¡ç‰‡å¾ç¾¤çµ„ A æ‹–æ”¾åˆ°ç¾¤çµ„ B
- **THEN** ç¾¤çµ„ A çš„å¡ç‰‡è¨ˆæ•¸é¡¯ç¤ºç‚º 4
- **THEN** ç¾¤çµ„ B çš„å¡ç‰‡è¨ˆæ•¸é¡¯ç¤ºç‚º 4
- **THEN** UI å³æ™‚æ›´æ–°è¨ˆæ•¸æ•¸å­—

#### Scenario: è·¨é¡åˆ¥ç§»å‹•å¡ç‰‡
- **GIVEN** å¡ç‰‡ X å±¬æ–¼é¡åˆ¥ A çš„ç¾¤çµ„ A1
- **WHEN** ä½¿ç”¨è€…å°‡å¡ç‰‡ X æ‹–æ”¾åˆ°é¡åˆ¥ B çš„ç¾¤çµ„ B1
- **THEN** å¡ç‰‡ X çš„ `category` æ›´æ–°ç‚ºé¡åˆ¥ B çš„ ID
- **THEN** å¡ç‰‡ X çš„ `subcategoryId` æ›´æ–°ç‚ºç¾¤çµ„ B1 çš„ ID
- **THEN** å…©å€‹é¡åˆ¥çš„è³‡æ–™éƒ½æ­£ç¢ºæ›´æ–°

### Requirement: æ‹–æ”¾å€åŸŸåµæ¸¬
ç³»çµ±å¿…é ˆï¼ˆSHALLï¼‰æ­£ç¢ºåµæ¸¬æœ‰æ•ˆçš„æ‹–æ”¾ç›®æ¨™å€åŸŸï¼Œä¸¦æä¾›æ˜ç¢ºçš„è¦–è¦ºåé¥‹ã€‚

#### Scenario: æ‡¸åœåœ¨æœ‰æ•ˆæ‹–æ”¾å€åŸŸæ™‚é«˜äº®é¡¯ç¤º
- **GIVEN** ä½¿ç”¨è€…æ­£åœ¨æ‹–å‹•å¡ç‰‡
- **WHEN** æ»‘é¼ æ‡¸åœåœ¨å…¶ä»–ç¾¤çµ„çš„å¡ç‰‡å€åŸŸä¸Šæ–¹
- **THEN** è©²ç¾¤çµ„çš„èƒŒæ™¯é¡è‰²è®Šç‚ºæ·ºè—è‰²ï¼ˆè¡¨ç¤ºå¯æ”¾ç½®ï¼‰
- **THEN** é¡¯ç¤ºã€Œæ”¾ç½®åˆ°æ­¤ç¾¤çµ„ã€çš„æç¤ºæ–‡å­—

#### Scenario: æ‡¸åœåœ¨ç„¡æ•ˆå€åŸŸæ™‚é¡¯ç¤ºç¦æ­¢åœ–ç¤º
- **GIVEN** ä½¿ç”¨è€…æ­£åœ¨æ‹–å‹•å¡ç‰‡
- **WHEN** æ»‘é¼ ç§»åˆ°å·¦å´é‚Šæ¬„æˆ–å³å´ Open Tabs å€åŸŸ
- **THEN** æ»‘é¼ æ¸¸æ¨™è®Šç‚ºã€Œç¦æ­¢ã€åœ–ç¤ºï¼ˆğŸš«ï¼‰
- **THEN** ä¸é¡¯ç¤ºæ’å…¥æŒ‡ç¤ºç·š

#### Scenario: æ‹–æ”¾åˆ°ç„¡æ•ˆå€åŸŸæ™‚å–æ¶ˆæ“ä½œ
- **GIVEN** ä½¿ç”¨è€…æ­£åœ¨æ‹–å‹•å¡ç‰‡
- **WHEN** ä½¿ç”¨è€…åœ¨ç„¡æ•ˆå€åŸŸï¼ˆå¦‚æ¨™é¡Œåˆ—ã€é‚Šç•Œå¤–ï¼‰æ”¾é–‹æ»‘é¼ 
- **THEN** å¡ç‰‡è¿”å›åŸå§‹ä½ç½®
- **THEN** é †åºä¸è®Š

#### Scenario: æ”¾é–‹ï¼ˆDropï¼‰å¾Œç§»é™¤é«˜äº®
- **WHEN** ä½¿ç”¨è€…åœ¨ç¾¤çµ„å…§æ”¾é–‹æ»‘é¼ ï¼ˆDropï¼‰
- **THEN** ç„¡è«–æ“ä½œæˆåŠŸæˆ–å¤±æ•—ï¼Œè©²ç¾¤çµ„å¿…é ˆç«‹å³ç§»é™¤é«˜äº®æ¨£å¼
- **THEN** ç¢ºä¿ UI å›å¾©åˆ°åˆå§‹ç‹€æ…‹ï¼Œä¸æ®˜ç•™ä»»ä½•æ‹–æ›³è¦–è¦ºæ•ˆæœ

### Requirement: æ‹–æ”¾æ•ˆèƒ½å„ªåŒ–
ç³»çµ±å¿…é ˆï¼ˆSHALLï¼‰ç¢ºä¿æ‹–æ”¾æ“ä½œæµæš¢ï¼Œå³ä½¿åœ¨åŒ…å«å¤§é‡å¡ç‰‡çš„ç¾¤çµ„ä¸­ä¹Ÿä¸å¡é “ã€‚

#### Scenario: æ‹–æ”¾ 100 å¼µå¡ç‰‡çš„ç¾¤çµ„æ™‚ä¿æŒæµæš¢
- **GIVEN** ç¾¤çµ„åŒ…å« 100 å¼µå¡ç‰‡
- **WHEN** ä½¿ç”¨è€…æ‹–å‹•å…¶ä¸­ä¸€å¼µå¡ç‰‡
- **THEN** æ‹–å‹•éç¨‹ä¸­å¹€ç‡ä¿æŒ >30 FPS
- **THEN** æ’å…¥æŒ‡ç¤ºç·šå³æ™‚æ›´æ–°ï¼ˆå»¶é² <50msï¼‰
- **THEN** æ”¾ä¸‹å¡ç‰‡å¾Œé‡æ–°æ’åºåœ¨ 100ms å…§å®Œæˆ

#### Scenario: æ‰¹æ¬¡æ›´æ–° IndexedDB é¿å…é »ç¹å¯«å…¥
- **GIVEN** ä½¿ç”¨è€…å¿«é€Ÿé€£çºŒæ‹–æ”¾å¤šå¼µå¡ç‰‡
- **WHEN** ç³»çµ±åµæ¸¬åˆ°é€£çºŒæ“ä½œï¼ˆé–“éš” <500msï¼‰
- **THEN** ç³»çµ±ä½¿ç”¨ debounce å»¶é²å¯«å…¥ IndexedDBï¼ˆå»¶é² 300msï¼‰
- **THEN** å¤šæ¬¡æ‹–æ”¾åˆä½µç‚ºä¸€æ¬¡ IndexedDB å¯«å…¥
- **THEN** UI ç«‹å³æ›´æ–°ï¼ˆä¸ç­‰å¾…å¯«å…¥å®Œæˆï¼‰

#### Scenario: ä½¿ç”¨è™›æ“¬åŒ–è™•ç†å¤§é‡å¡ç‰‡
- **GIVEN** ç¾¤çµ„åŒ…å« 500+ å¼µå¡ç‰‡
- **WHEN** ä½¿ç”¨è€…é–‹å•Ÿè©²ç¾¤çµ„
- **THEN** ç³»çµ±åªæ¸²æŸ“å¯è¦‹å€åŸŸçš„å¡ç‰‡ï¼ˆè™›æ“¬åŒ–æ»¾å‹•ï¼‰
- **THEN** æ‹–æ”¾æ“ä½œä¸å—å½±éŸ¿ï¼ˆæ‹–åˆ°å¯è¦‹å€åŸŸå¤–æ™‚è‡ªå‹•æ»¾å‹•ï¼‰

### Requirement: å¤šå¼µå¡ç‰‡æ‰¹æ¬¡æ‹–æ”¾
ç³»çµ±å¿…é ˆï¼ˆSHALLï¼‰æ”¯æ´åŒæ™‚é¸æ“‡å¤šå¼µå¡ç‰‡ä¸¦ä¸€æ¬¡æ‹–æ”¾ç§»å‹•ã€‚

#### Scenario: é¸æ“‡å¤šå¼µå¡ç‰‡
- **WHEN** ä½¿ç”¨è€…æŒ‰ä½ Ctrl/Cmd éµä¸¦é»æ“Šå¤šå¼µå¡ç‰‡
- **THEN** é¸ä¸­çš„å¡ç‰‡é¡¯ç¤ºè—è‰²é‚Šæ¡†
- **THEN** é¡¯ç¤ºé¸ä¸­æ•¸é‡æç¤ºï¼ˆä¾‹å¦‚ï¼šã€Œå·²é¸æ“‡ 3 å¼µå¡ç‰‡ã€ï¼‰

#### Scenario: æ‹–æ”¾å¤šå¼µé¸ä¸­çš„å¡ç‰‡
- **GIVEN** ä½¿ç”¨è€…é¸ä¸­ 3 å¼µå¡ç‰‡ï¼ˆcardA, cardB, cardCï¼‰
- **WHEN** ä½¿ç”¨è€…æ‹–å‹•å…¶ä¸­ä»»ä¸€å¼µå¡ç‰‡
- **THEN** 3 å¼µå¡ç‰‡ä¸€èµ·ç§»å‹•ï¼ˆé¡¯ç¤ºç‚ºå †ç–Šæ•ˆæœï¼‰
- **WHEN** ä½¿ç”¨è€…æ”¾ä¸‹å¡ç‰‡åˆ°æ–°ä½ç½®
- **THEN** 3 å¼µå¡ç‰‡æŒ‰åŸå§‹ç›¸å°é †åºæ’å…¥ï¼ˆä¿æŒ A-B-C é †åºï¼‰
- **THEN** ç³»çµ±æ›´æ–°é †åºé™£åˆ—

#### Scenario: è·¨ç¾¤çµ„æ‰¹æ¬¡ç§»å‹•
- **GIVEN** ä½¿ç”¨è€…é¸ä¸­ç¾¤çµ„ A çš„ 5 å¼µå¡ç‰‡
- **WHEN** ä½¿ç”¨è€…å°‡é¸ä¸­å¡ç‰‡æ‹–æ”¾åˆ°ç¾¤çµ„ B
- **THEN** 5 å¼µå¡ç‰‡çš„ `subcategoryId` éƒ½æ›´æ–°ç‚ºç¾¤çµ„ B
- **THEN** ç¾¤çµ„ A çš„é †åºç§»é™¤é€™ 5 å¼µå¡ç‰‡
- **THEN** ç¾¤çµ„ B çš„é †åºæ–°å¢é€™ 5 å¼µå¡ç‰‡
- **THEN** ç³»çµ±ä½¿ç”¨äº¤æ˜“ä¸€æ¬¡æ›´æ–°æ‰€æœ‰è®Šæ›´

### Requirement: æ’¤éŠ·æ‹–æ”¾æ“ä½œ
ç³»çµ±å¿…é ˆï¼ˆSHALLï¼‰æ”¯æ´æ’¤éŠ·æœ€è¿‘ä¸€æ¬¡çš„æ‹–æ”¾æ“ä½œï¼ˆUndoï¼‰ã€‚

#### Scenario: æ‹–æ”¾å¾Œç«‹å³æ’¤éŠ·
- **GIVEN** ä½¿ç”¨è€…å°‡ cardX å¾ä½ç½® 2 ç§»å‹•åˆ°ä½ç½® 5
- **WHEN** ä½¿ç”¨è€…æŒ‰ä¸‹ Ctrl+Zï¼ˆæˆ–é»æ“Šæ’¤éŠ·æŒ‰éˆ•ï¼‰
- **THEN** cardX è¿”å›ä½ç½® 2
- **THEN** é †åºæ¢å¾©ç‚ºæ‹–æ”¾å‰çš„ç‹€æ…‹
- **THEN** IndexedDB æ›´æ–°ç‚ºåŸå§‹é †åº

#### Scenario: æ’¤éŠ·è·¨ç¾¤çµ„ç§»å‹•
- **GIVEN** ä½¿ç”¨è€…å°‡ cardX å¾ç¾¤çµ„ A ç§»å‹•åˆ°ç¾¤çµ„ B
- **WHEN** ä½¿ç”¨è€…æŒ‰ä¸‹ Ctrl+Z
- **THEN** cardX è¿”å›ç¾¤çµ„ A çš„åŸå§‹ä½ç½®
- **THEN** cardX çš„ `subcategoryId` æ¢å¾©ç‚ºç¾¤çµ„ A çš„ ID
- **THEN** å…©å€‹ç¾¤çµ„çš„é †åºéƒ½æ¢å¾©

#### Scenario: æ’¤éŠ·å †ç–Šé™åˆ¶
- **GIVEN** ä½¿ç”¨è€…åŸ·è¡Œäº† 10 æ¬¡æ‹–æ”¾æ“ä½œ
- **WHEN** ä½¿ç”¨è€…é€£çºŒæŒ‰ä¸‹ Ctrl+Z
- **THEN** ç³»çµ±æœ€å¤šæ’¤éŠ·æœ€è¿‘ 5 æ¬¡æ“ä½œï¼ˆé™åˆ¶æ’¤éŠ·å †ç–Šæ·±åº¦ï¼‰
- **THEN** è¶…é 5 æ¬¡çš„æ­·å²æ“ä½œç„¡æ³•æ’¤éŠ·

### Requirement: è§¸æ§è£ç½®æ”¯æ´
ç³»çµ±å¿…é ˆï¼ˆSHALLï¼‰æ”¯æ´è§¸æ§è£ç½®ï¼ˆå¹³æ¿ã€è§¸æ§è¢å¹•ï¼‰çš„æ‹–æ”¾æ“ä½œã€‚

#### Scenario: é•·æŒ‰å¡ç‰‡é€²å…¥æ‹–æ”¾æ¨¡å¼
- **GIVEN** ä½¿ç”¨è€…åœ¨è§¸æ§è£ç½®ä¸Šä½¿ç”¨ LinkTrove
- **WHEN** ä½¿ç”¨è€…é•·æŒ‰å¡ç‰‡ï¼ˆæŒçºŒ >500msï¼‰
- **THEN** å¡ç‰‡é€²å…¥æ‹–æ”¾æ¨¡å¼ï¼ˆè¦–è¦ºåé¥‹èˆ‡æ»‘é¼ æ‹–æ”¾ç›¸åŒï¼‰
- **THEN** ä½¿ç”¨è€…å¯ç§»å‹•æ‰‹æŒ‡èª¿æ•´å¡ç‰‡ä½ç½®

#### Scenario: è§¸æ§æ‹–æ”¾æ™‚è‡ªå‹•æ»¾å‹•
- **GIVEN** ä½¿ç”¨è€…åœ¨è§¸æ§è£ç½®ä¸Šæ‹–å‹•å¡ç‰‡
- **WHEN** æ‰‹æŒ‡ç§»åˆ°è¢å¹•é‚Šç·£ï¼ˆä¸Šæ–¹æˆ–ä¸‹æ–¹ 10% å€åŸŸï¼‰
- **THEN** é é¢è‡ªå‹•å‘å°æ‡‰æ–¹å‘æ»¾å‹•
- **THEN** æ»¾å‹•é€Ÿåº¦æ ¹æ“šè·é›¢é‚Šç·£çš„è·é›¢èª¿æ•´

#### Scenario: æ”¾é–‹æ‰‹æŒ‡å®Œæˆæ‹–æ”¾
- **GIVEN** ä½¿ç”¨è€…åœ¨è§¸æ§è£ç½®ä¸Šæ‹–å‹•å¡ç‰‡
- **WHEN** ä½¿ç”¨è€…æ”¾é–‹æ‰‹æŒ‡
- **THEN** å¡ç‰‡æ”¾ç½®åˆ°ç•¶å‰ä½ç½®
- **THEN** åŸ·è¡Œèˆ‡æ»‘é¼ æ‹–æ”¾ç›¸åŒçš„é †åºæ›´æ–°é‚è¼¯

### Requirement: æ‹–æ”¾ç‹€æ…‹æŒä¹…åŒ–
ç³»çµ±å¿…é ˆï¼ˆSHALLï¼‰ç¢ºä¿æ‹–æ”¾æ“ä½œçš„çµæœå³æ™‚ä¸”å¯é åœ°å„²å­˜åˆ° IndexedDBã€‚

#### Scenario: æ‹–æ”¾å®Œæˆå¾Œç«‹å³å¯«å…¥ IndexedDB
- **WHEN** ä½¿ç”¨è€…å®Œæˆæ‹–æ”¾æ“ä½œ
- **THEN** ç³»çµ±åœ¨ 100ms å…§å°‡æ–°é †åºå¯«å…¥ IndexedDB
- **THEN** è‹¥å¯«å…¥å¤±æ•—ï¼Œç³»çµ±é‡è©¦æœ€å¤š 3 æ¬¡
- **THEN** è‹¥ä»å¤±æ•—ï¼Œç³»çµ±é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯ä¸¦å›æ»¾ UI ç‹€æ…‹

#### Scenario: é›¢ç·šæ™‚æ‹–æ”¾æ“ä½œ
- **GIVEN** IndexedDB å¯ç”¨ä½†ç¶²è·¯æ–·ç·šï¼ˆæœªä¾†é›²ç«¯åŒæ­¥åŠŸèƒ½ï¼‰
- **WHEN** ä½¿ç”¨è€…åŸ·è¡Œæ‹–æ”¾æ“ä½œ
- **THEN** ç³»çµ±æ­£å¸¸æ›´æ–° IndexedDB
- **THEN** ç³»çµ±æ¨™è¨˜è©²è®Šæ›´ç‚ºã€Œå¾…åŒæ­¥ã€ï¼ˆæœªä¾†åŠŸèƒ½ï¼‰

#### Scenario: æ‹–æ”¾éç¨‹ä¸­åˆ†é é—œé–‰
- **GIVEN** ä½¿ç”¨è€…æ­£åœ¨æ‹–å‹•å¡ç‰‡
- **WHEN** ä½¿ç”¨è€…æ„å¤–é—œé–‰åˆ†é ï¼ˆæ‹–æ”¾æœªå®Œæˆï¼‰
- **THEN** ä¸‹æ¬¡é–‹å•Ÿæ™‚ï¼Œé †åºä¿æŒæ‹–æ”¾å‰çš„ç‹€æ…‹ï¼ˆæœªæŒä¹…åŒ–ï¼‰
- **THEN** ä¸æœƒç”¢ç”Ÿéƒ¨åˆ†æ›´æ–°çš„è³‡æ–™æå£

### Requirement: Card Drop Timing
The system SHALL wait for the drop operation to complete before clearing the ghost preview state, ensuring smooth visual transition without flicker.

#### Scenario: Drop existing card to new position
- **WHEN** user drops a card to a new position
- **THEN** the ghost preview remains visible until the data update completes
- **AND** the ghost is cleared only after the card appears in its new position

#### Scenario: Drop operation fails
- **WHEN** user drops a card and the operation fails
- **THEN** the ghost preview is still cleared (via try-finally)
- **AND** an error message is shown to the user

## Related Documentation
- **æŠ€è¡“è¨­è¨ˆ**: `design.md` - æ‹–æ”¾å¯¦ä½œç´°ç¯€èˆ‡ç¨‹å¼åº«é¸æ“‡
- **åŠŸèƒ½æ–‡æª”**: `/docs/features/drag-drop-storage-display.md` - æ‹–æ”¾æ’åºå¯¦ä½œèªªæ˜
- **ç›¸é—œè¦æ ¼**: `../bookmark-management/spec.md` - é †åºç®¡ç†æ©Ÿåˆ¶
- **æ¸¬è©¦æ¡ˆä¾‹**: `src/app/__tests__/drag_integration.test.tsx` - æ‹–æ”¾æ•´åˆæ¸¬è©¦
